<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CryptoLock</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Landing / Bienvenida -->
  <section class="landing" id="landing">

    <!-- TOP BAR (nuevo) -->
    <header class="topbar-site">
      <div class="topbar-left">
        <!-- Logo FIEE -->
        <img class="topbar-logo" src="assets/logo.png" alt="FIEE" />
        <div class="topbar-brand">CryptoLock</div>
      </div>

      <div class="topbar-right">
        <!-- Usuario existente -->
        <button class="topbar-link" id="btnEnter">Acceder</button>

        <!-- Usuario nuevo -->
        <button class="topbar-cta" id="btnSignup">Crear una cuenta</button>
      </div>
    </header>

    <div class="landing-grid">
      <div class="landing-left">
        <h1>Identidad segura, trazable y sin contrase√±as</h1>

        <p class="landing-text">
          CryptoLock es un sistema IAM que permite autenticaci√≥n <b>passwordless</b>,
          gesti√≥n protegida de llaves criptogr√°ficas y el registro <b>inmutable</b> de accesos
          para garantizar integridad, trazabilidad y confiabilidad mediante blockchain.
        </p>

        <!-- Solo dejamos "Ver objetivos" (Acceder ahora est√° arriba) -->
        <div class="landing-actions">
          <button class="btn-outline" id="btnAbout">Ver objetivos</button>
        </div>

        <div class="landing-mini hidden" id="aboutBox">
          <h3>Objetivo del proyecto</h3>
          <ul>
            <li>Autenticaci√≥n segura sin contrase√±as (firma/OTP/biometr√≠a simulada).</li>
            <li>B√≥veda de llaves: la clave privada nunca se expone.</li>
            <li>Auditor√≠a de accesos con trazabilidad e integridad tipo blockchain.</li>
          </ul>
        </div>
      </div>

      <div class="landing-right">
        <img class="landing-FIEE" src="assets/FIEE.png" alt="Imagen CryptoLock" />
      </div>
    </div>
  </section>

  <div class="app hidden" id="dashboardApp">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">üîê</div>
        <div>
          <div class="brand-title">CryptoLock IAM</div>
          <div class="brand-sub">IAM Sistema de Gesti√≥n de Identidad y Acceso</div>
        </div>
      </div>

      <button class="compose" id="btnCompose">‚úçÔ∏è Nueva acci√≥n</button>

      <nav class="nav">
        <button class="nav-item active" data-view="inbox">üì• Bandeja (Eventos)</button>
        <button class="nav-item" data-view="vault">üóùÔ∏è B√≥veda de llaves</button>
        <button class="nav-item" data-view="methods">‚úÖ M√©todos</button>
        <button class="nav-item" data-view="security">üîê Seguridad (MFA)</button>
        <button class="nav-item" data-view="ledger">‚õìÔ∏è Blockchain</button>
      </nav>

      <div class="sidebar-footer">
        <div class="user-chip">üë§ Usuario: <b>Pedro</b></div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <input id="search" class="search" type="text" placeholder="Buscar eventos..." />
        <div class="top-actions">
          <button class="ghost" id="btnRefresh">‚ü≥</button>
          <button class="ghost">‚öôÔ∏è</button>
        </div>
      </header>

      <!-- Content -->
      <section class="content">
        <!-- Left list -->
        <div class="list" id="list"></div>

        <!-- Right detail -->
        <div class="detail" id="detail">
          <div class="detail-empty">
            <div class="big">üì©</div>
            <h2>Selecciona un evento</h2>
            <p>Haz click en un elemento de la lista para ver el detalle.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal: Nueva acci√≥n -->
  <div class="modal-backdrop hidden" id="modalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h3>Nueva acci√≥n</h3>
        <button class="ghost" id="btnCloseModal">‚úï</button>
      </div>

      <div class="modal-body">
        <label>Tipo de acci√≥n</label>
        <select id="actionType">
          <option>Solicitar acceso</option>
          <option>Registrar dispositivo</option>
          <option>Rotar llaves (simulado)</option>
          <option>Generar reto (challenge)</option>
        </select>

        <label>Descripci√≥n</label>
        <textarea id="actionDesc" rows="4" placeholder="Escribe una descripci√≥n..."></textarea>
      </div>

      <div class="modal-footer">
        <button class="btn" id="btnSendAction">Crear</button>
      </div>
    </div>
  </div>
<!-- Modal: Crear cuenta -->
<div class="modal-backdrop hidden" id="signupBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h3 id="signupTitle">Crear una cuenta</h3>
      <button class="ghost" id="btnCloseSignup">‚úï</button>
    </div>

    <div class="modal-body">

      <!-- PASO 1 -->
      <div id="signupStepForm">
        <label>Nombres</label>
        <input id="suFirstName" type="text" placeholder="Ej: Pedro" />

        <label>Apellidos</label>
        <input id="suLastName" type="text" placeholder="Ej: Arroyo" />

        <label>Correo (Gmail)</label>
        <input id="suEmail" type="email" placeholder="tuusuario@gmail.com" />

        <label>Contrase√±a</label>
        <input id="suPassword" type="password" placeholder="M√≠nimo 8 caracteres" />

        <label>Confirmar contrase√±a</label>
        <input id="suPassword2" type="password" placeholder="Repite la contrase√±a" />

        <label class="checkbox-row">
          <input id="suTerms" type="checkbox" />
          <span>Acepto los t√©rminos y condiciones</span>
        </label>

        <div class="form-hint" id="suHint">
          El correo debe terminar en <b>@gmail.com</b>.
        </div>
      </div>

    </div>

    <div class="modal-footer">
      <button class="btn" id="btnCreateAccount">Crear cuenta</button>
    </div>
  </div>
</div>

<!-- Modal: Verificaci√≥n OTP de registro -->
<div class="modal-backdrop hidden" id="signupOtpBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h3 id="signupOtpTitle">Verificar correo</h3>
      <button class="ghost" id="btnCloseSignupOtp" type="button">‚úï</button>
    </div>

    <div class="modal-body">
      <p class="form-hint" id="otpHint">Revisa tu correo y pega aqu√≠ el c√≥digo OTP.</p>

      <label>C√≥digo OTP</label>
      <input id="suOtp" type="text" placeholder="Ej: 893615" />
    </div>

    <div class="modal-footer">
      <button class="btn" id="btnVerifyOtp" type="button">Verificar</button>
      <button class="ghost" id="btnResendSignupOtp" type="button">Reenviar OTP</button>
    </div>
  </div>
</div>


  <!-- Toast -->
  <div id="toast" class="toast"></div>
<!-- =========================
     Modal ACCEDER (LOGIN)
========================= -->
<div class="backdrop hidden" id="loginBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="modal-head">
      <div>
        <h2 id="loginTitle">Acceder</h2>
        <p class="muted">Inicia sesi√≥n para entrar a tu dashboard.</p>
      </div>
      <button class="icon-btn" id="btnCloseLogin" aria-label="Cerrar">‚úï</button>
    </div>

    <form class="form" id="loginForm">
      <label class="field">
        <span>Correo o tel√©fono</span>
        <input id="liEmail" type="text" placeholder="Correo electr√≥nico o tel√©fono" required />
      </label>

      <label class="field">
        <span>Contrase√±a</span>
        <div class="password-row">
          <input id="liPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          <button type="button" class="ghost-btn" id="btnTogglePwd">Mostrar</button>
        </div>
      </label>

      <label class="check">
        <input type="checkbox" id="liRemember" />
        <span>Recordarme</span>
      </label>

      <button type="submit" class="primary-btn">Ingresar</button>
      <button type="button" class="ghost-btn" id="btnCryptoLogin">Ingresar con celular (firma)</button>


      <p class="muted small center">
        ¬øNo tienes cuenta?
        <a href="#" class="link" id="btnGoSignup">Crear cuenta</a>
      </p>
    </form>
  </div>
</div>
  <!-- Modal TOTP de acceso -->
  <div class="backdrop hidden" id="loginOtpBackdrop" aria-hidden="true">
    <div class="modal otp-modal" role="dialog" aria-modal="true" aria-labelledby="loginOtpTitle">
      <div class="modal-head">
        <div>
          <h2 id="loginOtpTitle">Verificaci√≥n de acceso</h2>
          <p class="muted" id="loginOtpHint">Ingresa el c√≥digo de 6 d√≠gitos de tu app autenticadora (Google Authenticator, Microsoft Authenticator, etc.).</p>
        </div>
        <button class="icon-btn" id="btnCloseLoginOtp" aria-label="Cerrar">‚úï</button>
      </div>

      <form class="form" id="loginOtpForm">
        <div class="totp-guide hidden" id="loginTotpGuide">
          <p class="totp-guide-title">Configura tu app autenticadora:</p>
          <ol>
            <li>Abre Google Authenticator / Microsoft Authenticator en tu celular.</li>
            <li>Escanea el QR o agrega manualmente la clave secreta.</li>
            <li>Ingresa el c√≥digo de 6 d√≠gitos generado para verificar tu acceso.</li>
          </ol>

          <img class="totp-qr" id="loginTotpQr" alt="QR TOTP" />
          <p class="muted small">Clave manual: <code id="loginTotpSecret">-</code></p>
        </div>

        <label class="field">
          <span id="loginOtpLabel">C√≥digo TOTP</span>
          <input id="liOtp" type="text" inputmode="numeric" placeholder="Ej: 123456" required />
        </label>

        <p class="muted small">Revisa tu app autenticadora en el celular para obtener el c√≥digo.</p>

        <button type="submit" class="primary-btn">Verificar TOTP</button>
      </form>
    </div>
  </div>

  <!-- Modal login cripto (challenge + firma) -->
  <div class="backdrop hidden" id="cryptoLoginBackdrop" aria-hidden="true">
    <div class="modal otp-modal" role="dialog" aria-modal="true" aria-labelledby="cryptoLoginTitle">
      <div class="modal-head">
        <div>
          <h2 id="cryptoLoginTitle">Login por firma criptografica</h2>
          <p class="muted" id="cryptoLoginHint">Escanea el QR desde tu celular/dispositivo con llave privada y aprueba el acceso.</p>
        </div>
        <button class="icon-btn" id="btnCloseCryptoLogin" aria-label="Cerrar">&#10005;</button>
      </div>

      <div class="form">
        <div class="crypto-login-grid">
          <div class="crypto-qr-wrap">
            <img class="totp-qr" id="cryptoChallengeQr" alt="QR challenge criptografico" />
            <p class="muted small center">QR para aprobar desde celular</p>
          </div>

          <div class="crypto-challenge-panel">
            <label class="field">
              <span>Challenge ID</span>
              <input id="cryptoChallengeId" type="text" readonly />
            </label>
            <label class="field">
              <span>Challenge</span>
              <textarea id="cryptoChallengeText" rows="3" readonly></textarea>
            </label>

            <div class="crypto-row">
              <button type="button" class="ghost-btn" id="btnRefreshCryptoChallenge">Regenerar challenge</button>
              <button type="button" class="ghost-btn" id="btnSignCryptoHere">Firmar en este dispositivo</button>
            </div>
          </div>
        </div>

        <p class="muted small" id="cryptoChallengeStatus">Esperando challenge...</p>
      </div>
    </div>
  </div>

  <!-- Modo celular para firmar challenge -->
  <section class="mobile-signer hidden" id="mobileSignerApp">
    <div class="mobile-signer-card">
      <h2>Aprobar acceso con firma</h2>
      <p class="muted">Este dispositivo firma el challenge con su llave privada y el backend verifica con la llave publica.</p>

      <label class="field">
        <span>Correo</span>
        <input id="mobileSignerEmail" type="text" readonly />
      </label>
      <label class="field">
        <span>Challenge ID</span>
        <input id="mobileSignerChallengeId" type="text" readonly />
      </label>
      <label class="field">
        <span>Challenge</span>
        <textarea id="mobileSignerChallengeText" rows="3" readonly></textarea>
      </label>

      <button class="primary-btn" id="btnApproveMobileChallenge" type="button">Firmar y aprobar acceso</button>
      <p class="muted small" id="mobileSignerStatus">Listo para firmar.</p>
    </div>
  </section>

  <!-- JS: l√≥gica del frontend (al final para asegurar que cargue todos los modales) -->
  <script src="./app.js?v=20260218-otpfix11"></script>

</body>
</html>

